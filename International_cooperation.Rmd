---
title: "International cooperation"
author: "Lingyu. Meng"
date: "2024-04-18"
output:
  pdf_document: default
  html_document: default
bibliography: references.bib
---

```{r setup, include=FALSE}
library("tidyverse")
library("ggExtra") # for marginal plot
library("scattermore")
library("cowplot")
library("gganimate")
# library("gifski") # for gif, need to install gifski but do not need to load it
# library("png") # for png, need to install png but do not need to load it
```

# Remote collaboration fuses more citable ideas (Now)

As the world becomes more connected, remote collaboration is becoming more common. However, the recent study rises a question: does remote collaboration really good for the scientific community? The paper published in Nature may provide some disappoiting answer. But if we look at the data, we may find some interesting things.

## Fewer breakthrough ideas?

Lin et al. @lin2023 found that remote collaboration fuses fewer breakthrough ideas. They analyzed the data of 20,134,803 papers published in 1960-2020. They found that the Dscore, which is a measure of the breakthrough ideas, is negatively correlated with the distance between collaborators.

Here is the abstract:

> Theories of innovation emphasize the role of social networks and teams as facilitators of breakthrough discoveries. Around the world, scientists and inventors are more plentiful and interconnected today than ever before. However, although there are more people making discoveries, and more ideas that can be reconfigured in new ways, research suggests that new ideas are getting harder to find — contradicting recombinant growth theory. Here we shed light on this apparent puzzle. Analysing 20 million research articles and 4 million patent applications from across the globe over the past half-century, we begin by documenting the rise of remote collaboration across cities, underlining the growing interconnectedness of scientists and inventors globally. We further show that across all fields, periods and team sizes, researchers in these remote teams are consistently less likely to make breakthrough discoveries relative to their on-site counterparts. Creating a dataset that allows us to explore the division of labour in knowledge production within teams and across space, we find that among distributed team members, collaboration centres on late-stage, technical tasks involving more codified knowledge. Yet they are less likely to join forces in conceptual tasks—such as conceiving new ideas and designing research—when knowledge is tacit. We conclude that despite striking improvements in digital technology in recent years, remote teams are less likely to integrate the knowledge of their members to produce new, disruptive ideas.

No need to ask, this paper exert a great influence. According to the [Altmetric](https://nature.altmetric.com/details/156927984), it has been mentioned in 41 news outlets and 2,117 tweeters.

Some people also have some doubts about the result. One must-read comment is from James Hawley @hawley2023, who carefully pointed out some concerns about the metrics, data, and the method. He also created a schematic to show how D score is calculated. The schematic is very helpful for understanding the paper.

The main concern can be summarized as follows:

1.  Data quality: There are large amounts of data with NaNs in the D score column. Most of the variance in D score is driven by 1% of the overall data.
2.  Method issue: The machine learning model used in the paper is not well explained, and the OLS is not appropriate for the data.
3.  Causality concern: The paper didn't discuss the potential confounding factors. For example, the Berkson’s paradox.

Hawley concluded that the paper is interesting but needs more work to be convincing. For this project, I will focus on the missing data and show how the missing data affect the result.

## Why the data is missing?

Considering that the missing data accounts for as much as 28% of the total dataset, it is essential to discuss why this data is missing and whether its absence affects the results. The original paper did not mention the missing data. However, as Hawley pointed out, the absence of D scores is likely due to the papers never being cited. One might argue that non-cited papers could be treated as having a D score of 0. However, given that even the least disruptive papers, which could potentially have a negative D score, are cited at least once, it is not appropriate to consider non-cited papers as more disruptive than non-disruptive papers. Therefore, treating non-cited papers as missing data is the most appropriate approach.

That means as long as the paper is cited, the D score is available. I would like to see whether the missing data is related to the distance between collaborators. Because different from agruable D score, the citation per se is directly and intuitively enough to reflect the quality of the paper.

Thanks to the open data policy, we can analse the missing data by ourselves.

The raw date used in this project can be found in [here](https://www.dropbox.com/scl/fi/16zx8y4he5l20iaahf3m8/RemoteTeam_DataForMainFigrues.zip?rlkey=c59tog9qecn61fvuzo9o0aczu&e=2&dl=0). Or using the provided link in the paper which is <https://lyl010.github.io>. You need click "Code & Data" and then click "Data" to navigate the data page. Please download the data, which is a file named "raw data.zip", and unzip it in the same directory as this file.


```{r data input, echo = FALSE}
dataset1 <- read_csv("raw data/Paperid_Remoteness_Authors_Teamroles.csv")
city_latlong <- read_csv("raw data/ScienceCityLatLong.csv")
paperid_year <- read_delim("raw data/Paperid_Year_Discipline_Teamsize_Distance_Dscore.txt", col_names =
                             c("Paperid","Year","Discipline","Teamsize","Distance","Dscore"), delim = "\t")
dataset2 <- read_delim("raw data/ScienceDisruptionCityEdges.txt", col_names = 
                         c("Connection","color","main_city","D_score1","D_score2"), delim = "\t")
dataset5 <- read_csv("raw data/Paperid_Remoteness_Authors_Teamroles.csv")
```

## Prepare data

```{r data reshaping}
connection_data <- dataset2 %>% 
  unite(D_score,c("D_score1","D_score2"),sep = ",")

# we use the same way to classify the discipline as the original paper
science_and_engineering = c("geology","medicine","mathematics","physics","materials science",
                            "biology","chemistry","engineering","computer science","geography",
                            "environmental science")
social_sciences <- c("political science","business","economics","psychology","sociology")
art_and_humanity <- c("history","art","philosophy")
# the definition above can be found in the code of the original paper

df <- bind_rows(
  data.frame(Discipline = science_and_engineering, fields = "science_and_engineering"),
  data.frame(Discipline = social_sciences, fields = "social_sciences"),
  data.frame(Discipline = art_and_humanity, fields = "art_and_humanity")
)

paperid_year <- left_join(paperid_year, df, by = "Discipline")
```

```{r top1 percent}
top_paper <- paperid_year %>% 
  filter(Dscore > 0.2)
# ds: Dscore; di: Distance; hist: histogram
ds_hist <- ggplot(top_paper, aes(x = Dscore))
ds_hist + geom_histogram()

# n0: no 0 (distance)
ds_n0_hist <- top_paper %>% 
  filter(Distance > 0) %>%
  ggplot(aes(x = Dscore))
ds_n0_hist + geom_histogram()

di_hist <- ggplot(top_paper, aes(x = Distance))
di_hist + geom_histogram()

di_n0_hist <- top_paper %>% 
  filter(Distance > 0) %>%
  ggplot(aes(x = Distance))
di_n0_hist + geom_histogram()

# d_d: distance vs Dscore
d_d <- ggplot(top_paper, aes(x = Distance, y = Dscore, color = Year)) +
  geom_point(alpha = 0.1) +
  theme_cowplot() +
  theme(legend.position = "left")
ggMarginal(d_d, type = "histogram")

d_d_n0 <- ggplot(top_paper %>% filter(Distance > 0), aes(x = Distance, y = Dscore, color = Year, shape = fields)) +
  geom_point(alpha = 0.1) +
  theme_cowplot() +
  theme(legend.position = "left")
ggMarginal(d_d_n0, type = "histogram")
```

It is obvious that there are several value of Dscore are extremely frequent. It is probably due to the few cited papers. Let's filter out those papers and replot the graph.

```{r frequency of Dscore}
# calculate the frequency of each Dscore value
frequency_Dscore <- top_paper %>% 
  group_by(Dscore) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n))

# filter out the few cited papers (extremely frequent Dscore)
# ex_lc: exclude the few cited papers
ex_fc <- left_join(top_paper, frequency_Dscore, by = "Dscore") %>% 
  filter(n < 1000) # that is an arbitrary threshold

d_d_n0_ex_fc <- ex_lc %>% 
  filter(Distance > 0) %>%
  ggplot(aes(x = Distance, y = Dscore, color = Year)) + 
  geom_point(alpha = 0.1) + theme_cowplot() + theme(legend.position = "left")
ggMarginal(d_d_n0_ex_fc, type = "histogram")
```

```{r log scale}
d_d_n0_log <- d_d_n0 + scale_x_continuous(trans = 'log10') + # Log scale for x-axis
  scale_y_continuous(trans = 'log10') +# Log scale for y-axis
  theme_cowplot() +
  theme(legend.position = "left")
ggMarginal(d_d_n0_log, type = "histogram")
```

Now we focus on the data of local collaboration, that is the distance is 0.

```{r distribution of Dscore in local}
# l: local
ds_hist_l_ex_fc <- ex_fc %>% 
  filter(Distance == 0) %>%
  ggplot(aes(x = Dscore))
ds_hist_l_ex_fc + geom_histogram()
```

The resason why distance is extremly right-skewed might be that those papers are demestic collaboration. It is impossible to investigate the affect of demestic / international collaboration on the Dscore due to the data lack of that information. However, we can use distance as a proxy of demestic / international collaboration. According SJR, Germany is top 4 country which published most paper and has a medium territory area, that is 357,021 km2. Let's assume that it is a circle, then the radius is 337 km. We can use this value as a threshold to distinguish demestic and international collaboration.

```{r data of demestic collabo}
# deme: demestic
d_d_deme_ex_fc <- ex_fc %>%
  filter(Distance < 337) %>%
  ggplot(aes(x = Distance, y = Dscore, color = Year)) +
  geom_point(alpha = 0.1) + theme_cowplot() +
  theme(legend.position = "left")
ggMarginal(d_d_deme_ex_fc, type = "histogram")

d_d_deme_n0_ex_fc <- ex_fc %>%
  filter(Distance < 337) %>%
  filter(Distance > 0) %>%
  ggplot(aes(x = Distance, y = Dscore, color = Year)) +
  geom_point(alpha = 0.1) + theme_cowplot() + 
  theme(legend.position = "left")
ggMarginal(d_d_deme_n0_ex_fc, type = "histogram")
```

```{r data of international collaboration}
d_d_inte <- ggplot(top_paper %>% filter(Distance > 700), aes(x = Distance, y = Dscore, color = Year, shape = fields)) +
  geom_point(alpha = 0.1) + theme_cowplot() +
  theme(legend.position = "left")
ggMarginal(d_d_inte, type = "histogram")
```

The data of international collaboration is also right-skewed. It is probably due to the convenience of international collaboration in the Europe. Let's consider the data of intercontinental collaboration in the next step. In top 10 countries which published most papers, the most close countries pair (intercontinental) are Australia and Japan. The distance between them is 6,766 km. Let's assume that it is a threshold to distinguish intercontinental collaboration.

```{r data of intercontinental collaboration}
d_d_interconti_ex_fc <- ex_fc %>%
  filter(Distance > 6766) %>%
  ggplot(aes(x = Distance, y = Dscore, color = Year)) +
  geom_point(alpha = 0.1) + theme_cowplot() +
  theme(legend.position = "left")
ggMarginal(d_d_interconti_ex_fc, type = "histogram")
```

For the most papers, which Dscore concentrated in the range of -0.2 to 0.2.

```{r data of 99 percent}
most_paper <- paperid_year %>% 
  filter(Dscore < 0.2) %>%
  filter(Dscore > -0.2)
# ds: Dscore; di: Distance; hist: histogram
ds_hist_most <- ggplot(most_paper, aes(x = Dscore))
ds_hist_most + geom_histogram()

# n0: no 0 (distance)
ds_n0_hist_most <- most_paper %>% 
  filter(Distance > 0) %>%
  ggplot(aes(x = Dscore))
ds_n0_hist_most + geom_histogram()

di_hist_most <- ggplot(most_paper, aes(x = Distance))
di_hist_most + geom_histogram()

di_n0_hist_most <- most_paper %>% 
  filter(Distance > 0) %>%
  ggplot(aes(x = Distance))
di_n0_hist_most + geom_histogram()

# d_d: distance vs Dscore
d_d_most <- ggplot(most_paper, aes(x = Distance, y = Dscore, color = Year)) +
  geom_scattermore(alpha = 0.1) # using scattermore for speed; otherwise, it will take forever
d_d_most + theme_cowplot()
ggMarginal(d_d_most, type = "histogram")
```

Let's see all the data in one graph.

```{r all data}
d_d_all <- ggplot(paperid_year, aes(x = Distance, y = Dscore, color = Year)) +
  geom_scattermore(alpha = 0.05) + theme_cowplot()
d_d_all

anim_all <- paperid_year %>% 
  ggplot(aes(x = Distance, y = Dscore, color = Year), frame(Year)) +
  geom_scattermore() +
  
anim_all
# ggMarginal(d_d_all, type = "histogram")

d_d_all_SE <- paperid_year %>%
  filter(fields == "science_and_engineering") %>%
  ggplot(aes(x = Distance, y = Dscore, color = Year)) +
  geom_scattermore(alpha = 0.05) + theme_cowplot() +
  scale_color_gradient(low="black", high="#619CFF") +
  title("Science and Engineering")
d_d_all_SE

d_d_all_SS <- paperid_year %>%
  filter(fields == "social_sciences") %>%
  ggplot(aes(x = Distance, y = Dscore, color = Year)) +
  geom_scattermore(alpha = 0.05) + theme_cowplot() +
  scale_color_gradient(low="black", high="#00BA38") +
  title("Social Sciences")
d_d_all_SS

d_d_all_AH <- paperid_year %>%
  filter(fields == "art_and_humanity") %>%
  ggplot(aes(x = Distance, y = Dscore, color = Year)) +
  geom_scattermore(alpha = 0.05) + theme_cowplot() +
  scale_color_gradient(low="black", high="#F8766D") +
  title("Art and Humanity")
d_d_all_AH

```

One potential explanation for the distribution of the data is the file-drawer problem. The file-drawer problem is a problem in meta-analysis in which studies with null results are less likely to be published than studies with significant results. It is possible that the data is biased because the less breakthrough results are less likely to be published. Let's see the distribution of the data by categories.

```{r analysis by categories}
breaks_distacne <- c(-1, 5000, 10000, 15000, 20000)
breaks_dscore <- c(-1, -0.5, 0, 0.5, 1)
data_classified <- paperid_year %>%
  mutate(Distance = cut(Distance, breaks = breaks_distacne, labels = c("0-5000", "5000-10000", "10000-15000", "15000-20000")),
         Dscore = cut(Dscore, breaks = breaks_dscore, labels = c("(-1, -0.5]", "(-0.5, 0]", "(0, 0.5]", "(0.5, 1]")))
table(data_classified$Distance, data_classified$Dscore) %>% 
prop.table(margin = 1)
d_d_all_classified <- ggplot(data_classified, aes(x = Distance, y = Dscore, color = Year)) +
```

Most papers are located in the range of 0 to 1000 km. If we weithed each data point by the number of papers in the same distance, we can see the distribution of the data more clearly.

```{r weighted data}
frequency_Distance_all <- paperid_year %>%
  group_by(Distance) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n))

# weighted distance
alldata_with_frequency <- left_join(paperid_year, frequency_Distance_all, by = "Distance")

# distance weighted
d_d_all_w <- ggplot(alldata_with_frequency, aes(x = Distance, y = Dscore, color = Year, alpha = 0.5/n)) +
  geom_scattermore() + theme_cowplot()
d_d_all_w
```

If you notice the missing data is as much as 1/3 of the total data. You may wonder how those missing data distributed, and how the missing data affect the result. Let's see the missing data.

```{r missing data}
missing_data <- paperid_year %>%
  filter(is.na(Dscore))

di_hist_miss <- ggplot(missing_data, aes(x = Distance))
di_hist_miss + geom_histogram()

year_hist_miss <- ggplot(missing_data, aes(x = Year))
year_hist_miss + geom_histogram()

# visualizing the missing data
breaks_distacne_fine <- c(-1, 0.5, 1000, 5000, 10000, 15000, 20000)
missing_data_cat <- paperid_year %>%
  select(Distance, Year, Dscore) %>%
  mutate(Distance = cut(Distance, breaks = breaks_distacne_fine,
                        labels = c("0", "1-1000", "1000-5000", "5000-10000", "10000-15000", "15000-20000"))) %>%
  group_by(Distance, Year) %>%
  summarise(N = n(), n = sum(is.na(Dscore)), .groups = 'drop') %>% 
  ungroup() %>% 
  mutate(missing_rate = n/N)

# y_d: Year vs Distance
y_d_missing <- missing_data_cat %>% 
  ggplot(aes(x = Distance, y = Year, fill = missing_rate,
             label = round(missing_rate, 2))) +
  geom_tile() +
  geom_text(color = "black") +  # Add text labels
  scale_fill_gradient(low = "white", high = "red") +
  labs(title = "Heatmap of missing data", fill = "Missing Rate") +
  theme_cowplot()
y_d_missing

odd_ratio <- missing_data_cat %>%
  select(Distance, Year, missing_rate) %>%
  pivot_wider(names_from = Distance, values_from = missing_rate)
# missing rate of 0 km / missing rate of other distance, that is relative citation rate for the given distance
odd_ratio[,3:7] <- odd_ratio$`0` / odd_ratio[,3:7] 

odd_ratio <- odd_ratio %>%
  select(-`0`) %>%
  pivot_longer(cols = 2:6, names_to = "Distance", values_to = "odd_ratio") %>% 
  mutate(Internet_Age = ifelse(Year < 1990, "No", "Yes")) # the establishment of Postmodern Culture in 1990 as the first online-only journal

# reorder the distance
custom_order <- c("0", "1-1000", "1000-5000", "5000-10000", "10000-15000", "15000-20000")
odd_ratio$Distance <- factor(odd_ratio$Distance, levels = custom_order)

anim_missing <- odd_ratio %>% 
  ggplot(aes(x = Distance, y = odd_ratio, fill = Internet_Age)) +
  geom_bar(stat = "identity") +
  transition_time(Year) +
  theme_cowplot() + 
  ease_aes('linear') +
  geom_abline(intercept = 1, slope = 0, linetype = "dashed") +
  labs(title = "Relative citation rate in {round(frame_time)}",
       y = "Odds Ratio", x = "Distance between collaborators (km)",
       caption = "Odds ratio higher than 1 means higher likelihood of being citated than local collaboration",
       fill = "Available in an online journal?") +
  labs(subtitle = "Remote versus on-site collaboration by distance between collaborators") +
  theme(axis.text.x = element_text(size = 10),
        legend.position = c(0.1, 0.85))
anim_missing
```

So in the row of 2015 which including data from 2015 to 2020, the missing rate is the highest. It is probably due to that 2020 is the year of data collection. Papers published in 2020 and a few years before are less likely to be cited.

Now, let's reanalyze the data using the regression model with Laplace prior.

```{r linear regression}
full_model <- vglm(Dscore ~ Distance + fields + Year, family = laplace, data = paperid_year)
# check which parameters can have priors
get_prior(Dscore ~ Distance + fields + Year, data = paperid_year)
# set the prior for the regression
prior <- set_prior("normal(0, 1)", class = "b") +
  set_prior("normal(0, 1)", class = "Intercept") +
  set_prior("cauchy(0, 1)", class = "sd")
# regression with Laplace distribution prior
linear_regression <- brm(Dscore ~ Distance + fields, data = paperid_year)

```

Using animation to show the changing of distance and Dscore along the year.

```{r animation}
main <- paperid_year %>% 
  ggplot(aes(x = Distance, y = Dscore, color = Year), frame(Year)) +
  geom_scattermore(alpha = 0.1) +
  theme_cowplot()
main + transition_time(Year)
```

# References
